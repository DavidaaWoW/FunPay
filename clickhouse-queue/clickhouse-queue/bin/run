#!/usr/bin/env php
<?php

use REES46\ClickHouse\Processor;
use REES46\Event\Amp;
use Workerman\Worker;

require 'init.php';

if( $cli->arguments->get('help') ) {
	$cli->usage();
} else {
	//Читаем конфиги
	$config = parse_ini_file(APP_ROOT . '/config/secrets.ini', true);

	//Указываем pid основного процесса
	Worker::$pidFile = APP_ROOT . '/log/daemon.pid';
	Worker::$logFile = APP_ROOT . '/log/daemon.log';

	Worker::$eventLoopClass = Amp::class;

	$worker = new Processor($cli, $config, 'Queue worker', 'rees46-clickhouse-queue');

	// run all workers
	Worker::runAll();
}
